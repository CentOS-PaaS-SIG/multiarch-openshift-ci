node("paas-sig-ci-slave01") {
  ansiColor('xterm') {
    timestamps {
      stage('init') {
        checkout(
          changelog: true,
          poll: true,
          scm: [
            $class: 'GitSCM',
            branches: [
              [name: 'origin/master']
            ],
            doGenerateSubmoduleConfigurations: false,
            browser: [
              $class: 'GithubWeb',
              repoUrl: 'https://github.com/openshift/origin'
            ],
            extensions: [
              [$class: 'CleanBeforeCheckout'],
              [$class: 'RelativeTargetDirectory', relativeTargetDir: 'origin']
            ],
            gitTool: 'Default',
            submoduleCfg: [],
            userRemoteConfigs: [
              [
                name: 'origin',
                refspec: '+refs/heads/master:refs/remotes/origin/master',
                url: 'https://github.com/openshift/origin.git'
              ],
              [
                name: 'detiber',
                refspec: '+refs/heads/multiarch:refs/remotes/detiber/multiarch',
                url: 'https://github.com/detiber/origin.git'
              ]
            ]
          ]
        )
        sh('''#!/usr/bin/bash -xeu
              pushd origin
              git merge detiber/multiarch
              popd
           ''')
      }

      def arches=['x86_64', 'aarch64', 'ppc64le', 's390x']
      def per_arch_jobs=[:]
      for (arch in arches) {
        per_arch_jobs[arch] = {
          stage('do something') {
             echo 'do something ${arch}'
          }
        }
      }
      parallel per_arch_jobs
      stage('post') {
        echo 'hi'
      }
    }
  }
}
